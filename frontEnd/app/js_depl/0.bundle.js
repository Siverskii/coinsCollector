webpackJsonp([0],{301:function(e,t,n){"use strict";var r;void 0!==(r=function(){var e={},t=-1;return{trigger:function(t,n){if(!e[t])return!1;e[t].forEach(function(e){return e.callback(n)})},on:function(n,r){e[n]||(e[n]=[]);var o=++t;return e[n].push({callback:r,subEventId:o}),o},off:function(t){Object.keys(e).forEach(function(n){e[n].forEach(function(r,o){r.subEventId==t&&(e[n].length>1?e[n].splice(o,1):delete e[n])})})}}}.call(t,n,t,e))&&(e.exports=r)},302:function(e,t,n){"use strict";var r,o;r=[n(316)],void 0!==(o=function(){return new function(){this.showConnectionError=function(){var e=Array.from(document.querySelectorAll(".page__footer_messField,.backPage__footer_messField"));e.forEach(function(e){e.classList.remove("completeMessage"),e.classList.add("errorMessage"),e.innerHTML="Сбой при загрузке, <br> проверьте соединение с интернетом."}),setTimeout(function(){e.forEach(function(e){e.classList.remove("errorMessage"),e.innerHTML=""}),e=null},6e3)},this.showCollectionHasLoaded=function(){var e=Array.from(document.querySelectorAll(".page__footer_messField,.backPage__footer_messField"));e.forEach(function(e){e.classList.add("completeMessage"),e.innerHTML="Все коллекции успешно загружены."}),setTimeout(function(){e.forEach(function(e){e.classList.remove("completeMessage"),e.innerHTML="<span class='arrow'>&#10150</span>"}),e=null},4e3)}}}.apply(t,r))&&(e.exports=o)},303:function(e,t,n){"use strict";var r,o;r=[n(301),n(313),n(312),n(315),n(309),n(314),n(310),n(306),n(311)],void 0!==(o=function(e,t,n,r,o,i,s,c,a){return new function(){var u=0;this.showContentPage=function(){(new t).render();l(),(new r).start()},this.addNewCoinsSeries=function(){return new Promise(function(t,r){new o({url:"getCoinsSeries",seriesNumber:u++}).fetch({success:function(r){var o=0;r.forEach(function(e){e.set({pageNumb:2*document.querySelectorAll(".contentSection").length+1,modelIndex:o++}),new n(e).render()}),e.trigger("addNewPages"),l(),t()},error:function(){r()}})})},e.on("addNewPages",function(){return l()}),e.on("pageCtrlGetCoinsDescr",function(t){var n=t.imgNum>11?1:0,r=t.view.querySelectorAll(".page__body")[n],o=r.querySelector(".coinsContainer"),i=r.querySelector(".coinDescriptionWrapper");new c({url:"getCoinDescription"}).fetch(t,{success:function(e,t){var n=.8,r=setInterval(function(){n-=.1,n>0?o.setAttribute("style","opacity:"+n):(clearInterval(r),o.setAttribute("style","opacity:0"),i.setAttribute("style","display:block"),o.setAttribute("style","display:none"))},30);t.set({coinsContainer:o,coinDescription:i}),new a(t).renderTo(i)},error:function(){e.trigger("showConnectionError")}})}),e.on("closeDescription",function(e){e.get("coinsContainer").setAttribute("style","display:flex"),e.get("coinDescription").setAttribute("style","display:none"),e.get("coinDescription").innerHTML=""}),this.showEndPage=function(){(new i).render(),e.trigger("addNewPages"),l()},this.showAboutPage=function(){(new s).render(),e.trigger("addNewPages"),l()};var l=function(){for(var t=Array.from(document.querySelectorAll(".pageSection")),n=t.length,r=0;r<n;r++){var o=window.getComputedStyle(t[r]).getPropertyValue("transform"),i=180*Math.acos(o.split(",")[0].split("(")[1])/Math.PI;"none"==o||180*Math.acos(o.split(",")[0].split("(")[1])/Math.PI<90?"none"==o?t[r].setAttribute("style","z-index:"+(n-r)):t[r].setAttribute("style","transform:rotateY("+-i+"deg); z-index:"+(n-r)):(180!=i&&(i=-i),t[r].setAttribute("style","transform:rotateY("+i+"deg); z-index:"+(2-(n-r-1))))}e.trigger("captureNewCurrentPageZindex")}}}.apply(t,r))&&(e.exports=o)},304:function(e,t,n){"use strict";var r,o;r=[],void 0!==(o=function(){var e=function(e){this.model=e};return e.prototype.render=function(e){var t=this,n=void 0;return n=void 0!=this.model?this.model.getAttr():{},document.querySelector(this.rootId).insertAdjacentHTML("beforeend",this.tpl(n,this.tagClass,this.viewId)),void 0!=this.events&&this.events.forEach(function(e){Array.from(document.querySelector(t.rootId).lastElementChild.querySelectorAll(e[1])).forEach(function(n){return n.addEventListener(e[0],t[e[2]].bind(t))})}),this},e.prototype.renderTo=function(e){var t=this;return e.insertAdjacentHTML("beforeend",this.tpl(this.model.getAttr(),this.tagClass,this.viewId)),void 0!=this.events&&this.events.forEach(function(n){Array.from(e.querySelectorAll(n[1])).forEach(function(e){return e.addEventListener(n[0],t[n[2]].bind(t))})}),this},e.prototype.extend=function(e){for(var t in e)Object.hasOwnProperty.call(e,t)&&(this[t]=e[t]);if(void 0!=this.events){var n=[];for(var r in this.events)if(Object.hasOwnProperty.call(this.events,r)){var o=r.split(" ");n.push([o[0],o[1],this.events[r]])}this.events=n}return this},e.prototype.remove=function(){void 0!=this.events&&this.events.forEach(function(e){Array.from(document.querySelector(e[1])).forEach(function(t){return t.removeEventListener(e[0],e[2])})})},e}.apply(t,r))&&(e.exports=o)},305:function(e,t,n){"use strict";var r;void 0!==(r=function(){return function(e){var t=document.querySelector(e).innerHTML;return new Function("model, tagClass, viewId","let source = "+JSON.stringify('<div id="<%=viewId%>" class="<%=tagClass%>">'+t+"</div>").replace(/<%=(.+?)%>/g,function(e,t){return'"+'+t.replace(/[&<>[](){}"']/g,"")+'+"'}).replace(/<%(.+?)%>/g,'";$1 source+="')+";return source;")}}.call(t,n,t,e))&&(e.exports=r)},306:function(e,t,n){"use strict";var r,o;r=[n(307)],void 0!==(o=function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.url=e.url||"test",delete e.url,this._coinAttr=e};return t.prototype.set=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in e)this._coinAttr[t]=e[t];return this},t.prototype.getAttr=function(){var e={};for(var t in this._coinAttr)e[t]=this._coinAttr[t];return e},t.prototype.get=function(e){return this._coinAttr[e]},t.prototype.fetch=function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.init({method:"GET",url:this.url+"?imgNum="+t.imgNum+"&imgPageNum="+t.imgPageNum+"&imgSeries="+t.imgSeries}).send().then(function(e){"200"==e.status?r.success(e,n.set(JSON.parse(e.data))):r.error(e)},function(){})},t.prototype.save=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=void 0;n=void 0!=this._coinAttr.id?"PUT":"POST",e.init({method:n,url:this.url}).send(this._coinAttr).then(function(e){"200"==e.status?t.success(e):t.error(e)},function(){})},t}.apply(t,r))&&(e.exports=o)},307:function(e,t,n){"use strict";var r;void 0!==(r=function(){var e=function(e){};return e.prototype.init=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.method=e.method,this.url=e.url,this.data=t,this},e.prototype.send=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise(function(n,r){var o=new XMLHttpRequest;o.open(e.method,e.url,!0),o.setRequestHeader("Content-Type","application/json"),o.addEventListener("load",function(){n({status:o.status,data:o.responseText})}),o.send(JSON.stringify(t))})},new e}.call(t,n,t,e))&&(e.exports=r)},308:function(e,t){},309:function(e,t,n){"use strict";var r,o;r=[n(307),n(306)],void 0!==(o=function(e,t){var n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.url=e.url+"?series="+e.seriesNumber,this.seriesNumber=e.seriesNumber,this.collection=[]};return n.prototype.pop=function(){return this.collection.pop()},n.prototype.fetch=function(){var n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.init({method:"GET",url:this.url}).send(null).then(function(e){if("200"==e.status){var o=JSON.parse(e.data);Object.keys(o).forEach(function(e){n.collection.push(new t(o[e]))}),r.success(n.collection)}else r.error(e)})},n}.apply(t,r))&&(e.exports=o)},310:function(e,t,n){"use strict";var r,o;r=[n(304),n(305)],void 0!==(o=function(e,t){return function(n){return new e(n).extend({rootId:".coinsBook",tpl:t("#aboutPage-tpl")})}}.apply(t,r))&&(e.exports=o)},311:function(e,t,n){"use strict";var r,o;r=[n(304),n(305),n(301)],void 0!==(o=function(e,t,n){return function(r){return new e(r).extend({tagClass:"coinDescription",tpl:t("#coinsDescription-tpl"),events:{"click .closeDescription":"closeDescription"},closeDescription:function(){n.trigger("closeDescription",this.model)}})}}.apply(t,r))&&(e.exports=o)},312:function(e,t,n){"use strict";var r,o;r=[n(304),n(301),n(305),n(308)],void 0!==(o=function(e,t,n){return function(r){return new e(r).extend({viewId:"view"+Date.now(),rootId:".coinsBook",tagClass:"",tpl:n("#coinPage-tpl"),events:{"click .coinsContainer":"getCoinsDescr","click .page__footer_messField":"openPage","click .backPage__footer_messField":"closePage"},getCoinsDescr:function(e){var n=["Города воинской славы","Древние города России","Российская Федерация","Русский балет","Красная книга","70-летие Победы","Памятные монеты"],r=n.indexOf(e.target.getAttribute("data-series"));-1!=r&&t.trigger("pageCtrlGetCoinsDescr",{imgNum:e.target.getAttribute("data-img"),imgPageNum:e.target.getAttribute("data-page"),imgSeries:r,view:document.querySelector("#"+this.viewId)})},openPage:function(){t.trigger("openPage",document.querySelector("#"+this.viewId).firstElementChild)},closePage:function(){t.trigger("closePage",document.querySelector("#"+this.viewId).firstElementChild)}})}}.apply(t,r))&&(e.exports=o)},313:function(e,t,n){"use strict";var r,o;r=[n(304),n(301),n(305),n(308)],void 0!==(o=function(e,t,n){return function(r){return new e(r).extend({viewId:"view"+Date.now(),rootId:"#coinEntrance",tagClass:"pageContainer",tpl:n("#startPage-tpl"),events:{"click .page__nav_item":"turnThePage","click .page__footer_messField":"openPage","click .backPage__footer_messField":"closePage"},turnThePage:function(e){var n=e.currentTarget;n.firstChild.classList.contains("loadingFog")||t.trigger("turnThePage",Math.floor(n.getAttribute("data-num")/2))},openPage:function(){t.trigger("openPage",document.querySelector(".chaptersSection"))},closePage:function(){t.trigger("closePage",document.querySelector(".chaptersSection"))}})}}.apply(t,r))&&(e.exports=o)},314:function(e,t,n){"use strict";var r,o;r=[n(304),n(305)],void 0!==(o=function(e,t){return function(n){return new e(n).extend({rootId:".coinsBook",tpl:t("#endPage-tpl")})}}.apply(t,r))&&(e.exports=o)},315:function(e,t,n){"use strict";var r,o;r=[n(301)],void 0!==(o=function(e){return function(){var t=void 0,n=void 0,r=void 0,o=void 0,i=void 0,s=void 0,c=void 0,a=void 0,u=void 0,l=void 0,d=void 0,f=!1,g=!1,v=!1,p=!1,m=!0;this.start=function(){var S=w(),P=Array.from(document.querySelectorAll(".pageSection")).length;e.on("addNewPages",function(){return y()}),e.on("captureNewCurrentPageZindex",function(){r&&(o=window.getComputedStyle(r).getPropertyValue("z-index"),i=u>=90?"matrix3d(-1, 0, 0, 0, 0, 1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 1)":window.getComputedStyle(r).getPropertyValue("transform"))}),window.addEventListener("orientationchange",function(){window.location.reload(!1)}),e.on("turnThePage",function(t){var n=document.querySelectorAll(".coinsSection"),r=Array.prototype.slice.call(n,0,t-2);t-2>0?(r.forEach(function(e){e.classList.toggle("hide")}),h(document.querySelector(".chaptersSection"),5),setTimeout(function(){h(n[t-2],5),setTimeout(function(){r.forEach(function(e){e.style.transform="rotateY(180deg)",e.classList.toggle("hide")}),e.trigger("addNewPages"),r=null},1e3)},650)):h(document.querySelector(".chaptersSection"),5)}),e.on("openPage",function(e){return h(e,5)}),e.on("closePage",function(e){return h(e,5,!0)}),window.addEventListener("resize",function(){S=w()}),document.addEventListener("mousemove",function(e){var r=0<n-S.top&&n<S.top+S.height;t=e.clientX,n=e.clientY,0<t-S.left&&t-S.left<75&&f&&r?(d=!0,document.body.setAttribute("style","cursor:move")):t<S.left+S.width&&t>S.left+S.width-75&&r?(l=!0,document.body.setAttribute("style","cursor:move")):(d=!1,l=!1,document.body.setAttribute("style","cursor:default"))}),document.addEventListener("mousemove",function(){(s||c)&&(c&&(u=(a-t)/6),s&&(u=180-(t-a)/6),u<=0&&(u=0),u>=180&&(u=180),g=!0,u>90?m&&(r.firstElementChild.setAttribute("style","z-index:0"),"matrix3d(-1, 0, 0, 0, 0, 1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 1)"==i||"matrix3d(-1, 0, -1.22465e-16, 0, 0, 1, 0, 0, 1.22465e-16, 0, -1, 0, 0, 0, 0, 1)"==i?r.setAttribute("style","z-index:"+o):r.setAttribute("style","z-index:"+(P-(o-1))),p=!0,m=!1):u<90&&p&&(r.firstElementChild.setAttribute("style","z-index:1"),"matrix3d(-1, 0, 0, 0, 0, 1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 1)"!=i&&"matrix3d(-1, 0, -1.22465e-16, 0, 0, 1, 0, 0, 1.22465e-16, 0, -1, 0, 0, 0, 0, 1)"!=i?r.setAttribute("style","z-index:"+o):r.setAttribute("style","z-index:"+(P-(o-1))),p=!1,m=!0),r.style.transform="rotateY("+-u+"deg)")}),y(),document.addEventListener("mouseup",function(){if(c=!1,s=!1,u<90&&g)var t=setInterval(function(){if(u<=5){if(r.style.transform="rotateY(0deg)",clearInterval(t),"col-xs-12 pageSection titleSection"!=r.className)return void(g=!1);var e=Math.round(document.querySelector(".coinsBook").getBoundingClientRect().left-S.left)/2;if(e>0)var n=setInterval(function(){e-=10,e>0?document.querySelector(".coinsBook").style.transform="translateX("+e+"px)":(document.querySelector(".coinsBook").style.transform="translateX(0px)",g=!1,clearInterval(n),f=!0,S=w())},20)}u-=4,u<=0&&(u=0),r.style.transform="rotateY("+-u+"deg)"},20);else if(u>=90&&g)var n=setInterval(function(){if(u>=175&&g){if(r.style.transform="rotateY(180deg)",clearInterval(n),"col-xs-12 pageSection titleSection"!=r.className)return void(g=!1);var t=Math.round(document.querySelector("#coinEntrance").getBoundingClientRect().right-document.querySelector(".coinsBook").getBoundingClientRect().right),o=0;if(t>0)var i=setInterval(function(){o+=10,o<t?document.querySelector(".coinsBook").style.transform="translateX("+o+"px)":(document.querySelector(".coinsBook").style.transform="translateX("+t+"px)",g=!1,clearInterval(i),f=!0,S=w(),v||(e.trigger("bookHaveOpened"),v=!0))},20)}else u+=4,u>=180&&(u=180),r&&(r.style.transform="rotateY("+-u+"deg)")},20)}),h(document.querySelector("#firstPage"))};var h=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){var o=180,i=setInterval(function(){o>0?(o<90&&t.setAttribute("style","z-index:100"),o-=n,t.style.transform="rotateY("+-o+"deg)"):(e.trigger("addNewPages"),t.style.transform="rotateY(0deg)",clearInterval(i))},20);setTimeout(function(){u=0,g=!0,r=t,document.dispatchEvent(new Event("mouseup"))},800)}else{var s=0,c=setInterval(function(){s<180?(s+=n,t.style.transform="rotateY("+-s+"deg)"):(e.trigger("addNewPages"),t.style.transform="rotateY(180deg)",clearInterval(c))},20);setTimeout(function(){u=180,g=!0,r=t,document.dispatchEvent(new Event("mouseup"))},800)}},y=function(){var e=!0,n=!1,u=void 0;try{for(var f,g=Array.from(document.getElementsByTagName("section"))[Symbol.iterator]();!(e=(f=g.next()).done);e=!0){f.value.addEventListener("mousedown",function(e){(d||l)&&(r=e.currentTarget,o=window.getComputedStyle(r).getPropertyValue("z-index"),i=window.getComputedStyle(r).getPropertyValue("transform"),a=t,d?s=!0:c=!0)})}}catch(e){n=!0,u=e}finally{try{!e&&g.return&&g.return()}finally{if(n)throw u}}},w=function(){var e=document.querySelector(".coinsBook").firstElementChild;return"matrix3d(-1, 0, 0, 0, 0, 1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 1)"===window.getComputedStyle(e).getPropertyValue("transform")||"matrix3d(-1, 0, -1.22465e-16, 0, 0, 1, 0, 0, 1.22465e-16, 0, -1, 0, 0, 0, 0, 1)"===window.getComputedStyle(e).getPropertyValue("transform")?document.querySelector("#coinEntrance").getBoundingClientRect():e.getBoundingClientRect()}}}.apply(t,r))&&(e.exports=o)},316:function(e,t){}});
//# sourceMappingURL=0.bundle.js.map